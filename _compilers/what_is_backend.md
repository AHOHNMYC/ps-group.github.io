---
title: 'А что такое Compiler Backend?'
---

Compiler Backend &mdash; один из двух ключевых компонентов компилятора, о котором можно сказать следующее:

- Backend получает на вход абстрактное синтаксическое дерево (AST), хранящее логическую модель файла исходного кода
- Backend создаёт на выходе машинный код (не исполняемый файл, а всего лишь объектный, такой как `*.obj` или `*.o`)
- Превращение AST в объектный файл происходит в три этапа: сначала из AST создаётся промежуточный код, затем промежуточный код улучшается оптимизатором, и в конце из промежуточного кода создаётся машинный

## Промежуточный код

Промежуточный код близок к ассемблеру, но абстрагирован от деталей конкретного процессора и может иметь свои ограничения в синтаксисе. Пример промежуточного кода (в формате LLVM-IR):

```llvm
define i32 @lambda(i8* %parent, i32 %x) {
    %1 = bitcast i8* %parent to i32*
    %2 = load i32* %1
    ; %2 = a
    %3 = add i32 %x, %2
    ret i32 %3
}
```

## Что надо знать до разработки бекенда

Для реализации бекенда простейшего, процедурного языка понадобится:

- Владеть паттернами проектирования: Строитель (Builder), Фасад (Facade)
- Знать детали работы языка C: что такое раздельная компиляция, статические и динамические библиотеки, соглашения о вызове (calling conventions), как через стек передаются параметры и возвращаемое значение, как работают указатели и массивы

Для реализации бекенда объектно-ориентированного языка также нужно:

- Знать детали работы языка C++: что такое раскрутка стека при выбросе исключения (stack unwinding), кодирование имён (name mangling), как устроены vtable и как реализовать полиморфизм с помощью hash-таблицы методов
